image: edbizarro/gitlab-ci-pipeline-php:7.3

stages:
  - Build and Publish

Publish CSS:
  stage: Build and Publish
  script:
    - npm install
    - npm run prod
    - node deploy/css.js "$CI_COMMIT_MESSAGE"
  artifacts:
    expire_in: 4 weeks
    paths:
      - dist/css
  only:
    refs:
      - master
    changes:
      - src/**/*.css


Publish JS:
  stage: Build and Publish
  script:
    - npm install
    - npm run prod
    - node deploy/js.js "$CI_COMMIT_MESSAGE"
  artifacts:
    expire_in: 4 weeks
    paths:
      - dist/js
  only:
    refs:
      - master
    changes:
      - src/**/*.js